# 澜码API Demo

一个基于Python Tkinter的图形界面程序，用于与澜码（Lanma）API进行交互，实现智能体问答功能。

## 功能特性

- 🎯 **API配置管理**：方便地设置和管理API密钥等基本信息
- 🔗 **智能体会话建立**：与智能体进行握手，获取会话ID
- 💬 **智能体问答交互**：支持两种模式与智能体进行实时对话
- 📊 **响应结果显示**：同时显示原始API响应和处理后的清晰结果
- ⌨️ **快捷操作**：支持回车键提交输入，操作更加便捷
- 🔄 **流式处理**：对话流模式支持实时响应显示
- 🎨 **友好界面**：简洁直观的图形用户界面

## 安装要求

### 系统要求
- macOS/Linux/Windows
- Python 3.6 或更高版本

### 依赖库
程序使用Python标准库，无需额外安装第三方依赖：
- `tkinter`：图形界面库
- `threading`：多线程支持
- `json`：JSON数据解析
- `subprocess`：执行命令行操作
- `os`：操作系统交互

## 使用说明

### 1. 启动程序

在项目目录下执行以下命令启动程序：

```bash
python3 lanma_api_demo.py
```

### 2. API配置

程序已经预设了默认的API配置，您也可以根据需要修改：

| 配置项 | 格式示例 | 说明 |
|--------|----------|------|
| API Key | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` | 澜码API密钥 |
| Agent sn | `agent-xxxxxxxxxxxxxxxxxxxx` | 智能体序列号 |
| Agent version sn | `ver-xxxxxxxxxxxxxxxxxxxx` | 智能体版本序列号 |

### 3. 建立会话

点击"和智能体握手"按钮与智能体建立会话连接。成功后，程序会自动获取并显示`sessionSn`。

### 4. 智能体问答

选择智能体类型后，在"和智能体问答"输入框中输入您的问题，按下回车键即可提交。

## 智能体类型说明

### 知识查询 (doc)
- **用途**：适合快速查询和知识检索
- **API端点**：`/agent-api/v1/open/knowledge/chat`
- **响应格式**：JSON格式，包含`answer`字段
- **特点**：响应速度快，适合获取精确信息

### 对话流 (chat)
- **用途**：适合连续对话和复杂问题处理
- **API端点**：`/agent-api/v1/open/agents/chat`
- **响应格式**：Form表单格式，包含`outputs`数组
- **特点**：支持流式响应，实时显示对话内容

## 程序界面说明

### 1. API配置区域

| 控件 | 说明 |
|------|------|
| API Key* | 输入您的澜码API密钥 |
| sessionSn | 显示与智能体建立会话后获取的会话ID（只读） |
| Agent sn* | 输入智能体序列号 |
| Agent version sn* | 输入智能体版本序列号 |
| 和智能体握手 | 与智能体建立会话的按钮 |

### 2. 操作区域

| 控件 | 说明 |
|------|------|
| Agent Type | 选择智能体类型（知识查询/对话流） |
| 和智能体问答 | 输入问题的文本框，支持回车键提交 |
| Output | 显示API请求和原始响应的窗口（蓝色文字） |
| Processed | 显示处理后的智能体回答结果的窗口 |

## 程序工作流程

1. **配置API信息**：使用预设或自定义的API配置
2. **建立会话**：点击握手按钮，程序发送会话建立请求，获取sessionSn
3. **选择智能体类型**：根据需要选择"知识查询"或"对话流"
4. **发送问题**：用户输入问题并按下回车键
5. **处理请求**：
   - 程序清空Output和Processed窗口
   - 根据选择的类型生成对应的curl命令
   - 执行API调用并接收响应
6. **显示结果**：
   - 在Output窗口显示原始API响应（蓝色文字）
   - 解析API响应，提取智能体回答
   - 在Processed窗口显示处理后的结果

## API响应处理

### 知识查询模式
- **解析路径**：`data.content.answer`
- **处理逻辑**：收集所有answer值，忽略最后一个，拼接其余
- **显示格式**：纯文本形式

### 对话流模式
- **解析路径**：`data.content.outputs[].output`
- **处理逻辑**：遍历outputs数组，提取每个output项，忽略最后一个
- **显示格式**：流式拼接的文本形式

## 常见问题

### 1. 为什么点击握手按钮没有反应？

请检查：
- 是否填写了完整的API Key、Agent sn和Agent version sn
- 网络连接是否正常
- API密钥是否有效

### 2. 为什么无法提交问题？

请检查：
- 是否已经成功获取了sessionSn（显示为NA表示未获取）
- 输入框是否为空

### 3. 对话流模式下Processed窗口为什么没有显示内容？

- 检查API响应格式是否正确
- 程序会从`data.content.outputs[].output`路径提取内容
- 可以在Output窗口查看调试信息

### 4. 程序出现卡死怎么办？

- 程序已优化UI更新频率，避免频繁刷新
- 如果仍有问题，可以重启程序
- 确保网络连接稳定

## 技术说明

### 主要功能实现

1. **多线程处理**：使用线程避免UI阻塞，提高用户体验
2. **实时响应显示**：API响应实时显示在界面上
3. **智能响应解析**：自动识别响应格式并提取关键信息
4. **用户友好交互**：支持快捷键操作，界面简洁直观
5. **性能优化**：减少不必要的UI更新，防止界面卡死

### 关键代码结构

```
LanmaAPIDemo
├── __init__()                      # 初始化程序和界面变量
├── create_widgets()                 # 创建界面控件
├── handshake_with_agent()           # 建立智能体会话
├── submit_input()                   # 提交用户输入和请求处理
├── process_stream_response()        # 处理知识查询模式响应
└── process_chat_stream_response()   # 处理对话流模式响应
```

### 性能优化特性

- **批量UI更新**：减少频繁的界面刷新，提高响应性能
- **异步处理**：使用多线程避免界面阻塞
- **超时管理**：120秒超时保护，避免长时间等待
- **错误处理**：完善的异常处理和用户提示

## 版本历史

### v2.0.0（当前版本）
- ✨ 新增智能体类型选择（知识查询/对话流）
- ✨ 对话流模式支持流式响应处理
- 🔧 优化UI更新频率，解决界面卡死问题
- 🔧 增加详细的调试信息显示
- 🔧 更新默认API配置值
- 🐛 修复Processed窗口显示问题
- 🎨 改进界面响应速度和用户体验

### v1.0.0
- 🎉 初始版本发布
- ✅ 基本API交互功能
- ✅ 图形用户界面
- ✅ 实时响应显示

## 许可证

本项目采用MIT许可证。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 联系方式

如有问题或建议，请联系项目维护者。